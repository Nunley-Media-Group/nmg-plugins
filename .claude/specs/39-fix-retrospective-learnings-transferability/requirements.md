# Defect Report: Retrospective learnings produce project-specific regression notes instead of transferable patterns

**Issue**: #39
**Date**: 2026-02-16
**Status**: Draft
**Author**: Claude
**Severity**: High
**Related Spec**: `.claude/specs/1-spec-retrospective-skill/`

---

## Reproduction

### Steps to Reproduce

1. Accumulate several defect specs with `Related Spec` links in any project
2. Run `/running-retrospectives`
3. Read `.claude/steering/retrospective.md`

### Environment

| Factor | Value |
|--------|-------|
| **Plugin Version** | 2.11.0 |
| **Observed In** | chrome-cli project (13 defect specs analyzed, 12 learnings — all project-specific) |

### Frequency

Always — the skill instructions systematically produce project-specific output.

---

## Expected vs Actual

| | Description |
|---|-------------|
| **Expected** | Learnings are generalized, cross-cutting spec-writing patterns transferable to any project. Multiple defects sharing a root pattern are aggregated into a single learning. Example: "When specifying features that interact with external systems via session-scoped protocols, include ACs for state persistence across invocations." |
| **Actual** | Learnings are project-specific regression notes tied to individual defect scenarios. Each defect produces its own learning. Example: "Feature spec for `emulate status` did not account for CDP session isolation." |

### Root Cause

Four compounding issues in `plugins/nmg-sdlc/skills/running-retrospectives/SKILL.md`:

1. **Step 3 line 58** — backward-looking framing ("what the feature spec should have included") produces notes about *that* spec rather than patterns for *future* specs
2. **Step 5 (Filter Learnings)** — filters by scope but provides no guidance on abstraction level
3. **No cross-defect aggregation** — learnings are generated one-per-defect with no instruction to identify shared patterns and merge
4. **Template** — frames usage as "avoid repeating past spec gaps" (backward-looking) rather than "apply patterns to new contexts" (forward-looking)

---

## Acceptance Criteria

**IMPORTANT: Each criterion becomes a Gherkin BDD test scenario.**

### AC1: Learnings are generalized and transferable

**Given** a project with defect specs linked to feature specs
**When** `/running-retrospectives` is run
**Then** each learning is framed as a transferable spec-writing pattern applicable beyond the specific project domain, without project-specific terminology or implementation details

### AC2: Cross-cutting patterns are aggregated

**Given** multiple defect specs that share a common root pattern (e.g., three defects all caused by session-scoped state not persisting across invocations)
**When** `/running-retrospectives` analyzes them
**Then** they are merged into a single cross-cutting learning with the individual defects listed as supporting evidence, rather than producing separate per-defect learnings

### AC3: Existing defect details preserved as evidence

**Given** a cross-cutting learning aggregated from multiple defects
**When** the retrospective document is written
**Then** each learning references its source defect specs so the origin is traceable, but the learning text itself is domain-agnostic

### AC4: Writing-specs consumes generalized learnings effectively

**Given** a `retrospective.md` containing generalized cross-cutting learnings
**When** `/writing-specs` reads it during Phase 1
**Then** the learnings are interpreted as transferable principles and adapted to the current feature's context rather than applied literally

### AC5: Migrating-projects detects retrospective template drift

**Given** a project with an existing `.claude/steering/retrospective.md` generated by an older template
**When** `/migrating-projects` is run after a plugin update that changed the retrospective template
**Then** the retrospective template is included in the heading diff and missing sections are offered for migration alongside other steering docs

---

## Functional Requirements

| ID | Requirement | Priority |
|----|-------------|----------|
| FR1 | Step 3 must instruct the agent to extract generalized, transferable patterns rather than project-specific notes | Must |
| FR2 | A new aggregation step must group defects sharing a root pattern into single cross-cutting learnings | Must |
| FR3 | The retrospective template must be restructured for cross-cutting learnings with defect evidence references | Must |
| FR4 | Step 5 filter must include abstraction-level guidance (not too specific, not too generic) | Must |
| FR5 | `/writing-specs` Phase 1 instructions must guide adaptive application of generalized learnings | Should |
| FR6 | `/migrating-projects` Step 1 must resolve the retrospective template and diff existing `retrospective.md` files against it | Must |

---

## Out of Scope

- Changing the defect spec template or how defect specs are written
- Multi-repo retrospective aggregation
- Changing how `/verifying-specs` generates defect specs
- Automated abstraction-level validation of learnings

---

## Validation Checklist

Before moving to PLAN phase:

- [x] Reproduction steps are repeatable and specific
- [x] Expected vs actual behavior is clearly stated
- [x] Severity is assessed
- [x] Acceptance criteria use Given/When/Then format
- [x] At least one regression scenario is included (AC3 — evidence traceability preserved)
- [x] Fix scope is minimal — no feature work mixed in
- [x] Out of scope is defined
